<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Nizebook - Smart Reading Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-bg: #F8FAFC;
            --secondary-bg: #FFFFFF;
            --accent-color: #3B82F6;
            --text-primary: #1F2937;
            --text-secondary: #6B7280;
            --border-color: #E5E7EB;
            --hover-bg: #F3F4F6;
            --sidebar-bg: #F9FAFB;
        }

        [data-theme="dark"] {
            --primary-bg: #0F172A;
            --secondary-bg: #1E293B;
            --accent-color: #60A5FA;
            --text-primary: #F1F5F9;
            --text-secondary: #CBD5E1;
            --border-color: #334155;
            --hover-bg: #334155;
            --sidebar-bg: #1E293B;
        }

        body {
            background-color: var(--primary-bg);
            color: var(--text-primary);
            transition: all 0.3s ease;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .card {
            background-color: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        /* Left Navigation Sidebar */
        .nav-sidebar {
            background-color: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            width: 80px;
            min-height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 30;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem 0;
        }

        .nav-icon {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0.5rem 0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            color: var(--text-secondary);
        }

        .nav-icon:hover {
            background-color: var(--hover-bg);
            color: var(--accent-color);
        }

        .nav-icon.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .nav-divider {
            width: 60%;
            height: 1px;
            background-color: var(--border-color);
            margin: 1rem 0;
        }

        /* Top Controls Bar */
        .top-controls {
            background-color: var(--secondary-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 40;
            margin-left: 80px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .controls-section {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .theme-toggle {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            background-color: var(--hover-bg);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-primary);
        }

        .theme-toggle:hover {
            background-color: var(--accent-color);
            color: white;
        }

        .mini-select {
            background-color: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            color: var(--text-primary);
            min-width: 60px;
        }

        /* Main Content Area */
        .main-content {
            margin-left: 80px;
            min-height: 100vh;
            padding: 1.25rem; /* 20px */
        }

        /* Dictionary & Notes Panel */
        .right-panel {
            background-color: var(--sidebar-bg);
            border-left: 1px solid var(--border-color);
            width: 320px;
            min-height: 100vh;
            position: fixed;
            right: 0;
            top: 0;
            z-index: 30;
            padding: 1rem;
        }

        .main-content-with-panel {
            margin-right: 320px;
        }

        .chapter-item {
            transition: all 0.2s ease;
            cursor: pointer;
            padding: 0.75rem;
            margin: 0.25rem 0;
            border-radius: 8px;
        }

        .chapter-item:hover {
            background-color: var(--hover-bg);
        }

        .chapter-item.active {
            background-color: var(--accent-color);
            color: white;
        }

        .upload-zone {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-zone:hover {
            border-color: var(--accent-color);
            background-color: var(--hover-bg);
        }

        .upload-zone.dragover {
            border-color: var(--accent-color);
            background-color: var(--hover-bg);
        }

        .note-item {
            background-color: var(--hover-bg);
            padding: 0.75rem;
            border-radius: 8px;
            margin: 0.5rem 0;
            border-left: 3px solid var(--accent-color);
        }

        .reading-content {
            font-size: 1.125rem;
            line-height: 1.8;
            max-width: none;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background-color: var(--hover-bg);
        }

        .recording-indicator {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .library-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .book-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .book-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .summary-point {
            background-color: var(--hover-bg);
            padding: 1rem;
            border-radius: 8px;
            margin: 0.5rem 0;
            border-left: 4px solid var(--accent-color);
        }

        .audio-note-card {
            background-color: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            transition: all 0.3s ease;
        }

        .audio-note-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .analysis-textarea {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--secondary-bg);
            color: var(--text-primary);
            resize: vertical;
        }

        .voice-prompt {
            background: linear-gradient(135deg, var(--accent-color), #8B5CF6);
            color: white;
            padding: 1rem;
            border-radius: 12px;
            margin: 1rem 0;
            text-align: center;
            font-style: italic;
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--border-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 3px;
        }

        @media (max-width: 1024px) {
            .nav-sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .nav-sidebar.open {
                transform: translateX(0);
            }
            
            .right-panel {
                transform: translateX(100%);
                transition: transform 0.3s ease;
            }
            
            .right-panel.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .main-content-with-panel {
                margin-right: 0;
            }
            
            .top-controls {
                margin-left: 0;
            }

            .library-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .card {
                padding: 1rem;
            }
        }

        @media (max-width: 640px) {
            .library-grid {
                grid-template-columns: 1fr;
            }

            .upload-zone {
                padding: 2rem;
            }

            .right-panel {
                width: 100%;
                height: auto;
                position: fixed;
                top: auto;
                bottom: 0;
                transform: translateY(100%);
            }

            .right-panel.open {
                transform: translateY(0);
            }
        }

        /* PDF Export Optimization */
        @media print {
            .nav-sidebar, .right-panel {
                position: relative !important;
                width: auto !important;
                min-height: auto !important;
            }
            
            .main-content {
                margin: 0 !important;
                padding: 1rem !important;
            }
            
            .top-controls {
                position: relative !important;
                margin-left: 0 !important;
            }
            
            .no-print {
                display: none !important;
            }
            
            .section {
                display: block !important;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <!-- Left Navigation Sidebar -->
    <div class="nav-sidebar" id="navSidebar">
        <div class="nav-icon active" onclick="showSection('home')" title="Home">
            <i class="fas fa-home text-xl"></i>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-icon" onclick="showSection('library')" title="Books">
            <i class="fas fa-book text-xl"></i>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-icon" onclick="showSection('audio-library')" title="Audio Notes">
            <i class="fas fa-headphones text-xl"></i>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-icon" onclick="showSection('analysis')" title="Analysis">
            <i class="fas fa-chart-line text-xl"></i>
        </div>
    </div>

    <!-- Top Controls Bar -->
    <div class="top-controls">
        <div class="logo-section">
            <i class="fas fa-book-open text-2xl" style="color: var(--accent-color);"></i>
            <h1 class="text-xl font-bold">Enhanced Nizebook</h1>
        </div>
        <div class="controls-section">
            <select id="languageSelector" class="mini-select">
                <option value="en">EN</option>
                <option value="yo">YO</option>
                <option value="ig">IG</option>
                <option value="ha">HA</option>
                <option value="fr">FR</option>
                <option value="es">ES</option>
                <option value="ar">AR</option>
                <option value="sw">SW</option>
                <option value="pt">PT</option>
                <option value="de">DE</option>
                <option value="it">IT</option>
                <option value="ru">RU</option>
                <option value="zh">ZH</option>
                <option value="ja">JA</option>
                <option value="hi">HI</option>
            </select>
            <select id="voiceSelector" class="mini-select">
                <option value="male">Male â™‚</option>
                <option value="female">Female â™€</option>
                <option value="child">Child ðŸ‘¶</option>
                <option value="teen">Teen ðŸ§‘</option>
                <option value="teen-male">Teen Male ðŸ§‘</option>
                <option value="teen-female">Teen Female ðŸ‘©</option>
            </select>
            <div class="theme-toggle no-print" onclick="toggleTheme()" id="themeToggle">
                <i class="fas fa-sun"></i>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content main-content-with-panel" id="mainContent">
        <!-- Home Section -->
        <div id="home" class="section active">
            <div class="max-w-6xl mx-auto pt-10">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold mb-4">Welcome to Enhanced Nizebook</h2>
                    <p class="text-xl text-gray-600 mb-8">Your intelligent reading companion with voice notes and AI analysis</p>
                </div>

                <div class="upload-zone" onclick="document.getElementById('fileInput').click()" ondrop="handleFileDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <i class="fas fa-cloud-upload-alt text-6xl mb-4" style="color: var(--accent-color);"></i>
                    <h3 class="text-2xl font-semibold mb-2">Upload Your First Document</h3>
                    <p class="text-gray-600 mb-4">Drag and drop your PDF, DOCX, or TXT file here</p>
                    <button class="btn-primary">
                        <i class="fas fa-plus mr-2"></i>Choose File
                    </button>
                    <input type="file" id="fileInput" class="hidden" accept=".pdf,.docx,.txt" onchange="handleFileUpload(event)">
                </div>

                <div class="card p-6 mt-12">
                    <h3 class="text-2xl font-semibold mb-4">About Nizebook</h3>
                    <p class="text-gray-600">Nizebook is a smart reading platform designed to enhance your learning experience. Upload documents, organize them into chapters, record voice notes, and leverage AI-powered analysis to deepen your understanding. With support for multiple languages and intuitive navigation, Nizebook makes reading and studying seamless and engaging.</p>
                </div>

                <div class="grid md:grid-cols-4 gap-8 mt-12">
                    <div class="card p-6 text-center">
                        <i class="fas fa-book-reader text-4xl mb-4" style="color: var(--accent-color);"></i>
                        <h3 class="text-lg font-semibold mb-2">Smart Reading</h3>
                        <p class="text-gray-600">Automatic chapter detection and smart pagination</p>
                    </div>
                    <div class="card p-6 text-center">
                        <i class="fas fa-language text-4xl mb-4" style="color: var(--accent-color);"></i>
                        <h3 class="text-lg font-semibold mb-2">Multi-Language</h3>
                        <p class="text-gray-600">Read in 15+ languages including Yoruba and Igbo</p>
                    </div>
                    <div class="card p-6 text-center">
                        <i class="fas fa-microphone text-4xl mb-4" style="color: var(--accent-color);"></i>
                        <h3 class="text-lg font-semibold mb-2">Voice Notes</h3>
                        <p class="text-gray-600">Record audio notes with automatic saving</p>
                    </div>
                    <div class="card p-6 text-center">
                        <i class="fas fa-brain text-4xl mb-4" style="color: var(--accent-color);"></i>
                        <h3 class="text-lg font-semibold mb-2">AI Analysis</h3>
                        <p class="text-gray-600">Get detailed explanations and examples</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reading Section -->
        <div id="reading" class="section">
            <div class="max-w-5xl mx-auto">
                <div class="flex justify-between items-center mb-6">
                    <button onclick="showSection('library')" class="btn-secondary">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Library
                    </button>
                    <div class="flex items-center space-x-4">
                        <span id="readingProgress" class="text-sm text-gray-600">Page 1 of 1</span>
                        <div class="w-32 h-2 bg-gray-200 rounded-full">
                            <div id="progressBar" class="h-2 bg-blue-500 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="card p-8">
                    <h1 id="currentBookTitle" class="text-3xl font-bold mb-2">Book Title</h1>
                    <h2 id="currentChapterTitle" class="text-xl text-gray-600 mb-6">Chapter Title</h2>
                    
                    <div class="voice-prompt" id="voicePrompt" style="display: none;">
                        <i class="fas fa-microphone mr-2"></i>
                        "Some things are best understood with your own voice, so add your voice to remember what this chapter really means"
                    </div>
                    
                    <div id="readingContent" class="reading-content">
                        <p>Content will appear here...</p>
                    </div>
                </div>

                <div class="flex justify-between items-center mt-6">
                    <button onclick="previousPage()" id="prevBtn" class="btn-secondary">
                        <i class="fas fa-chevron-left mr-2"></i>Previous
                    </button>
                    <div class="flex space-x-4">
                        <button onclick="toggleRecording()" id="recordBtn" class="btn-primary">
                            <i class="fas fa-microphone mr-2"></i>Record Note
                        </button>
                        <button onclick="speakCurrentPage()" class="btn-secondary">
                            <i class="fas fa-volume-up mr-2"></i>Listen
                        </button>
                    </div>
                    <button onclick="nextPage()" id="nextBtn" class="btn-primary">
                        Next<i class="fas fa-chevron-right ml-2"></i>
                    </button>
                </div>

                <!-- Chapter List (appears when reading) -->
                <div class="card p-6 mt-6" id="chaptersList" style="display: none;">
                    <h3 class="text-lg font-semibold mb-4">Chapters</h3>
                    <div id="chaptersContent"></div>
                </div>
            </div>
        </div>

        <!-- Library Section -->
        <div id="library" class="section">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold">My Library</h2>
                <button onclick="document.getElementById('fileInput').click()" class="btn-primary">
                    <i class="fas fa-plus mr-2"></i>Add Book
                </button>
            </div>
            
            <div id="libraryGrid" class="library-grid">
                <div class="text-center py-12 col-span-full">
                    <i class="fas fa-book text-6xl text-gray-400 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-600 mb-2">No books yet</h3>
                    <p class="text-gray-500">Upload your first document to get started</p>
                </div>
            </div>
        </div>

        <!-- Audio Library Section -->
        <div id="audio-library" class="section">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold">Audio Notes</h2>
                <span id="audioCount" class="text-sm text-gray-500">0 recordings</span>
            </div>
            
            <div id="audioNotesGrid" class="space-y-4">
                <div class="text-center py-12">
                    <i class="fas fa-microphone text-6xl text-gray-400 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-600 mb-2">No audio notes yet</h3>
                    <p class="text-gray-500">Start reading and record your thoughts</p>
                </div>
            </div>
        </div>

        <!-- Analysis Section -->
        <div id="analysis" class="section">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold">AI Document Analysis</h2>
                <button onclick="document.getElementById('analysisFileInput').click()" class="btn-primary">
                    <i class="fas fa-upload mr-2"></i>Analyze Document
                </button>
                <input type="file" id="analysisFileInput" class="hidden" accept=".pdf,.docx,.txt" onchange="analyzeDocument(event)">
            </div>

            <!-- Enhanced Analysis Input -->
            <div class="card p-6 mb-6">
                <h3 class="text-xl font-semibold mb-4">Need Help Understanding Something?</h3>
                <p class="text-gray-600 mb-4">Paste any text, paragraph, or concept you'd like explained with examples:</p>
                <textarea 
                    id="customAnalysisInput" 
                    class="analysis-textarea" 
                    placeholder="Paste your text here or describe what you need explained..."
                ></textarea>
                <div class="flex justify-between items-center mt-4">
                    <div class="flex space-x-2">
                        <button onclick="explainText()" class="btn-primary">
                            <i class="fas fa-brain mr-2"></i>Explain with Examples
                        </button>
                        <button onclick="searchWebExamples()" class="btn-secondary">
                            <i class="fas fa-search mr-2"></i>Find Web Examples
                        </button>
                    </div>
                    <button onclick="clearAnalysisInput()" class="btn-secondary">
                        <i class="fas fa-trash mr-2"></i>Clear
                    </button>
                </div>
            </div>
            
            <div id="analysisResults" class="space-y-6">
                <div class="text-center py-12">
                    <i class="fas fa-chart-line text-6xl text-gray-400 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-600 mb-2">No analysis yet</h3>
                    <p class="text-gray-500">Upload a document or paste text to see AI-powered insights</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Panel - Dictionary & Notes -->
    <div class="right-panel" id="rightPanel">
        <h3 class="text-lg font-semibold mb-4">Dictionary & Notes</h3>
        
        <!-- Dictionary Search -->
        <div class="mb-6">
            <div class="flex space-x-2 mb-4">
                <input type="text" id="dictionaryInput" placeholder="Search any word..." class="flex-1 p-3 border border-gray-300 rounded-lg text-sm">
                <button onclick="searchDictionary()" class="btn-primary px-3">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <div id="dictionaryResults" class="min-h-32 p-4 bg-gray-50 rounded-lg text-sm">
                <p class="text-gray-500 text-center">Search for a word to see its definition</p>
            </div>
        </div>

        <!-- Quick Notes -->
        <div class="mb-6">
            <h4 class="font-semibold mb-2">Quick Note</h4>
            <textarea id="quickNoteInput" placeholder="Write a quick note..." class="w-full p-3 border border-gray-300 rounded-lg h-20 text-sm"></textarea>
            <button onclick="saveQuickNote()" class="btn-primary w-full mt-2 text-sm">
                <i class="fas fa-save mr-2"></i>Save Note
            </button>
        </div>

        <!-- Notes List -->
        <div>
            <h4 class="font-semibold mb-4">Your Notes</h4>
            <div id="notesList" class="space-y-2 max-h-64 overflow-y-auto">
                <div class="text-center text-gray-500 py-4">
                    <i class="fas fa-sticky-note text-2xl mb-2"></i>
                    <p class="text-sm">No notes yet</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentBooks = JSON.parse(localStorage.getItem('nizebook_books')) || [];
        let currentNotes = JSON.parse(localStorage.getItem('nizebook_notes')) || [];
        let currentAudioNotes = JSON.parse(localStorage.getItem('nizebook_audio_notes')) || [];
        let currentBook = null;
        let currentChapter = 0;
        let currentPage = 0;
        let isRecording = false;
        let mediaRecorder = null;
        let audioChunks = [];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadTheme();
            displayLibrary();
            displayNotes();
            displayAudioNotes();
            updateLanguage();
            
            // Ensure main content adjusts with right panel
            document.getElementById('mainContent').classList.add('main-content-with-panel');
        });

        // Theme management
        function loadTheme() {
            const theme = localStorage.getItem('nizebook_theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
            const toggle = document.getElementById('themeToggle');
            toggle.innerHTML = theme === 'dark' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('nizebook_theme', newTheme);
            loadTheme();
        }

        // Section management
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('.nav-icon').forEach(icon => icon.classList.remove('active'));
            document.getElementById(sectionName).classList.add('active');
            document.querySelector(`[onclick="showSection('${sectionName}')"]`).classList.add('active');
            
            if (sectionName === 'reading') {
                displayCurrentPage();
                document.getElementById('chaptersList').style.display = 'block';
            } else {
                document.getElementById('chaptersList').style.display = 'none';
            }
        }

        // File handling
        function handleFileDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) processFile(files[0]);
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('dragover');
        }

        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (file) processFile(file);
        }

        function processFile(file) {
            showToast('Processing document...', 'info');
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                const book = {
                    id: Date.now(),
                    title: file.name.replace(/\.[^/.]+$/, ""),
                    content: content,
                    chapters: extractChapters(content),
                    currentChapter: 0,
                    currentPage: 0,
                    uploadDate: new Date().toISOString()
                };
                
                currentBooks.push(book);
                localStorage.setItem('nizebook_books', JSON.stringify(currentBooks));
                currentBook = book;
                displayLibrary();
                displayChapters();
                showSection('reading');
                showToast('Document uploaded successfully!', 'success');
            };
            reader.readAsText(file);
        }

        function extractChapters(content) {
            const chapters = [];
            const lines = content.split('\n');
            let currentChapter = { title: 'Introduction', content: '', pages: [] };
            let currentContent = '';
            
            lines.forEach(line => {
                const trimmedLine = line.trim();
                if (trimmedLine.match(/^(Chapter|CHAPTER)\s+\d+/i) || 
                    trimmedLine.match(/^\d+\.\s+/) ||
                    trimmedLine.match(/^[A-Z][A-Z\s]{5,}$/)) {
                    if (currentContent) {
                        currentChapter.pages = splitIntoPages(currentContent);
                        chapters.push(currentChapter);
                        currentChapter = { 
                            title: trimmedLine || `Chapter ${chapters.length + 1}`, 
                            content: '', 
                            pages: [] 
                        };
                        currentContent = '';
                    } else {
                        currentChapter.title = trimmedLine;
                    }
                } else {
                    currentContent += line + '\n';
                }
            });
            
            if (currentContent) {
                currentChapter.pages = splitIntoPages(currentContent);
                chapters.push(currentChapter);
            }
            
            return chapters.length > 0 ? chapters : [{
                title: 'Full Document',
                content: content,
                pages: splitIntoPages(content)
            }];
        }

        function splitIntoPages(content) {
            const wordsPerPage = 350;
            const words = content.split(/\s+/).filter(w => w.length > 0);
            const pages = [];
            
            for (let i = 0; i < words.length; i += wordsPerPage) {
                pages.push(words.slice(i, i + wordsPerPage).join(' '));
            }
            
            return pages.length > 0 ? pages : [content];
        }

        // Display functions
        function displayLibrary() {
            const grid = document.getElementById('libraryGrid');
            if (currentBooks.length === 0) {
                grid.innerHTML = `
                    <div class="text-center py-12 col-span-full">
                        <i class="fas fa-book text-6xl text-gray-400 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">No books yet</h3>
                        <p class="text-gray-500">Upload your first document to get started</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = currentBooks.map(book => `
                <div class="book-card card p-6" onclick="openBook(${book.id})">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-book text-3xl mr-4" style="color: var(--accent-color);"></i>
                        <div class="flex-1">
                            <h3 class="font-semibold text-lg truncate">${book.title}</h3>
                            <p class="text-sm text-gray-600">${book.chapters.length} chapters</p>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-500">
                            ${new Date(book.uploadDate).toLocaleDateString()}
                        </span>
                        <span class="text-sm font-medium" style="color: var(--accent-color);">
                            Ch. ${book.currentChapter + 1}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        function displayChapters() {
            const chaptersContent = document.getElementById('chaptersContent');
            if (!currentBook) return;
            
            chaptersContent.innerHTML = currentBook.chapters.map((chapter, index) => `
                <div class="chapter-item ${index === currentChapter ? 'active' : ''}" 
                     onclick="goToChapter(${index})">
                    <div class="font-medium truncate">${chapter.title}</div>
                    <div class="text-sm opacity-75">${chapter.pages.length} pages</div>
                </div>
            `).join('');
        }

        function displayCurrentPage() {
            if (!currentBook) return;
            
            const chapter = currentBook.chapters[currentChapter];
            const page = chapter.pages[currentPage];
            
            document.getElementById('currentBookTitle').textContent = currentBook.title;
            document.getElementById('currentChapterTitle').textContent = chapter.title;
            document.getElementById('readingContent').innerHTML = `<p>${page}</p>`;
            
            if (Math.random() < 0.3) {
                document.getElementById('voicePrompt').style.display = 'block';
                setTimeout(() => document.getElementById('voicePrompt').style.display = 'none', 5000);
            }
            
            const totalPages = currentBook.chapters.reduce((sum, ch) => sum + ch.pages.length, 0);
            const currentPageNum = currentBook.chapters.slice(0, currentChapter).reduce((sum, ch) => sum + ch.pages.length, 0) + currentPage + 1;
            const progress = Math.round((currentPageNum / totalPages) * 100);
            
            document.getElementById('readingProgress').textContent = `Page ${currentPageNum} of ${totalPages}`;
            document.getElementById('progressBar').style.width = `${progress}%`;
            
            document.getElementById('prevBtn').disabled = currentChapter === 0 && currentPage === 0;
            document.getElementById('nextBtn').disabled = 
                currentChapter === currentBook.chapters.length - 1 && 
                currentPage === chapter.pages.length - 1;
                
            displayChapters();
            saveProgress();
        }

        function displayNotes() {
            const notesList = document.getElementById('notesList');
            if (currentNotes.length === 0) {
                notesList.innerHTML = `
                    <div class="text-center text-gray-500 py-4">
                        <i class="fas fa-sticky-note text-2xl mb-2"></i>
                        <p class="text-sm">No notes yet</p>
                    </div>
                `;
                return;
            }
            
            notesList.innerHTML = currentNotes.map(note => `
                <div class="note-item">
                    <div class="flex justify-between items-start mb-2">
                        <span class="font-medium text-sm truncate">${note.bookTitle || 'Unknown Book'}</span>
                        <span class="text-xs text-gray-500">
                            ${new Date(note.timestamp).toLocaleDateString()}
                        </span>
                    </div>
                    <p class="text-sm mb-2">${note.content}</p>
                    <div class="text-xs text-gray-500">
                        Chapter ${note.chapter + 1}, Page ${note.page + 1}
                    </div>
                </div>
            `).join('');
        }

        function displayAudioNotes() {
            const audioGrid = document.getElementById('audioNotesGrid');
            const audioCount = document.getElementById('audioCount');
            
            if (currentAudioNotes.length === 0) {
                audioGrid.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-microphone text-6xl text-gray-400 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">No audio notes yet</h3>
                        <p class="text-gray-500">Start reading and record your thoughts</p>
                    </div>
                `;
                audioCount.textContent = '0 recordings';
                return;
            }
            
            audioCount.textContent = `${currentAudioNotes.length} recordings`;
            audioGrid.innerHTML = currentAudioNotes.map(note => `
                <div class="audio-note-card">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-semibold text-lg">${note.bookTitle || 'Audio Note'}</h4>
                            <p class="text-sm text-gray-600">Chapter ${note.chapter + 1}, Page ${note.page + 1}</p>
                        </div>
                        <span class="text-xs text-gray-500">
                            ${new Date(note.timestamp).toLocaleDateString()}
                        </span>
                    </div>
                    <div class="flex items-center justify-between">
                        <button onclick="playAudioNote('${note.id}')" class="btn-primary">
                            <i class="fas fa-play mr-2"></i>Play Recording
                        </button>
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-clock mr-1"></i>
                            ${note.duration || 'Unknown'} sec
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Navigation functions
        function openBook(bookId) {
            currentBook = currentBooks.find(book => book.id === bookId);
            currentChapter = currentBook.currentChapter || 0;
            currentPage = currentBook.currentPage || 0;
            displayChapters();
            showSection('reading');
        }

        function goToChapter(chapterIndex) {
            currentChapter = chapterIndex;
            currentPage = 0;
            displayCurrentPage();
        }

        function nextPage() {
            const chapter = currentBook.chapters[currentChapter];
            if (currentPage < chapter.pages.length - 1) {
                currentPage++;
            } else if (currentChapter < currentBook.chapters.length - 1) {
                currentChapter++;
                currentPage = 0;
            }
            displayCurrentPage();
        }

        function previousPage() {
            if (currentPage > 0) {
                currentPage--;
            } else if (currentChapter > 0) {
                currentChapter--;
                currentPage = currentBook.chapters[currentChapter].pages.length - 1;
            }
            displayCurrentPage();
        }

        function saveProgress() {
            if (currentBook) {
                currentBook.currentChapter = currentChapter;
                currentBook.currentPage = currentPage;
                localStorage.setItem('nizebook_books', JSON.stringify(currentBooks));
            }
        }

        // Dictionary function
        async function searchDictionary() {
            const input = document.getElementById('dictionaryInput');
            const results = document.getElementById('dictionaryResults');
            const word = input.value.trim();
            
            if (!word) return;
            
            results.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin"></i> Searching...</div>';
            
            try {
                const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                const data = await response.json();
                
                if (data && data[0]) {
                    const entry = data[0];
                    const meaning = entry.meanings[0];
                    results.innerHTML = `
                        <div class="space-y-2">
                            <h4 class="font-semibold">${entry.word}</h4>
                            <p class="text-sm"><strong>${meaning.partOfSpeech}</strong></p>
                            <p class="text-sm">${meaning.definitions[0].definition}</p>
                            ${entry.phonetic ? `<p class="text-xs text-gray-500">Pronunciation: ${entry.phonetic}</p>` : ''}
                        </div>
                    `;
                } else {
                    results.innerHTML = `<p class="text-sm text-gray-500">No definition found for "${word}"</p>`;
                }
            } catch (error) {
                results.innerHTML = `<p class="text-sm text-gray-500">Error searching for "${word}"</p>`;
            }
        }

        // Notes functions
        function saveQuickNote() {
            const input = document.getElementById('quickNoteInput');
            const content = input.value.trim();
            
            if (!content) return;
            
            const note = {
                id: Date.now(),
                content: content,
                type: 'text',
                bookId: currentBook ? currentBook.id : null,
                bookTitle: currentBook ? currentBook.title : null,
                chapter: currentChapter,
                page: currentPage,
                timestamp: new Date().toISOString()
            };
            
            currentNotes.unshift(note);
            localStorage.setItem('nizebook_notes', JSON.stringify(currentNotes));
            input.value = '';
            displayNotes();
            showToast('Note saved!', 'success');
        }

        // Audio recording functions
        async function toggleRecording() {
            const recordBtn = document.getElementById('recordBtn');
            
            if (!isRecording) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    const startTime = Date.now();
                    
                    mediaRecorder.ondataavailable = event => audioChunks.push(event.data);
                    mediaRecorder.onstop = () => {
                        const duration = Math.round((Date.now() - startTime) / 1000);
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        saveAudioNote(audioUrl, duration);
                        stream.getTracks().forEach(track => track.stop());
                    };
                    
                    mediaRecorder.start();
                    isRecording = true;
                    recordBtn.innerHTML = '<i class="fas fa-stop mr-2 recording-indicator"></i>Stop Recording';
                    recordBtn.classList.add('bg-red-500');
                    document.getElementById('voicePrompt').style.display = 'block';
                    showToast('Recording started...', 'info');
                } catch (error) {
                    showToast('Could not access microphone', 'error');
                }
            } else {
                mediaRecorder.stop();
                isRecording = false;
                recordBtn.innerHTML = '<i class="fas fa-microphone mr-2"></i>Record Note';
                recordBtn.classList.remove('bg-red-500');
                document.getElementById('voicePrompt').style.display = 'none';
            }
        }

        function saveAudioNote(audioUrl, duration) {
            const note = {
                id: Date.now(),
                content: audioUrl,
                type: 'audio',
                duration: duration,
                bookId: currentBook ? currentBook.id : null,
                bookTitle: currentBook ? currentBook.title : null,
                chapter: currentChapter,
                page: currentPage,
                timestamp: new Date().toISOString()
            };
            
            currentAudioNotes.unshift(note);
            localStorage.setItem('nizebook_audio_notes', JSON.stringify(currentAudioNotes));
            displayAudioNotes();
            showToast('Audio note saved automatically!', 'success');
            setTimeout(() => showSection('audio-library'), 1500);
        }

        function playAudioNote(noteId) {
            const note = currentAudioNotes.find(n => n.id == noteId);
            if (note && note.type === 'audio') {
                const audio = new Audio(note.content);
                audio.play();
                showToast('Playing audio note...', 'info');
            }
        }

        // Text-to-speech function
        function speakCurrentPage() {
            if (!currentBook) return;
            
            const text = currentBook.chapters[currentChapter].pages[currentPage];
            const utterance = new SpeechSynthesisUtterance(text);
            const voiceType = document.getElementById('voiceSelector').value;
            const voices = speechSynthesis.getVoices();
            
            switch(voiceType) {
                case 'male':
                    utterance.pitch = 0.8;
                    utterance.rate = 0.9;
                    utterance.voice = voices.find(voice => voice.name.toLowerCase().includes('male')) || voices[0];
                    break;
                case 'female':
                    utterance.voice = voices.find(voice => voice.name.toLowerCase().includes('female')) || voices[0];
                    break;
                case 'child':
                    utterance.pitch = 1.5;
                    utterance.rate = 1.2;
                    break;
                case 'teen':
                    utterance.pitch = 1.2;
                    utterance.rate = 1.1;
                    break;
                case 'teen-male':
                    utterance.pitch = 0.9;
                    utterance.rate = 1.0;
                    break;
                case 'teen-female':
                    utterance.pitch = 1.1;
                    utterance.rate = 1.0;
                    break;
                default:
                    utterance.pitch = 1.0;
                    utterance.rate = 1.0;
            }
            
            speechSynthesis.speak(utterance);
            showToast('Reading aloud...', 'info');
        }

        // Analysis functions
        function analyzeDocument(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            showToast('Analyzing document...', 'info');
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                const analysis = performAnalysis(content);
                displayAnalysis(analysis, file.name);
            };
            reader.readAsText(file);
        }

        function explainText() {
            const input = document.getElementById('customAnalysisInput');
            const text = input.value.trim();
            
            if (!text) {
                showToast('Please enter some text to analyze', 'warning');
                return;
            }
            
            showToast('Analyzing text...', 'info');
            const explanation = generateExplanation(text);
            displayExplanation(explanation, text);
        }

        function searchWebExamples() {
            const input = document.getElementById('customAnalysisInput');
            const text = input.value.trim();
            
            if (!text) {
                showToast('Please enter some text to search for', 'warning');
                return;
            }
            
            const keywords = extractKeywords(text).slice(0, 3);
            const searchUrls = keywords.map(keyword => ({
                keyword: keyword,
                url: `https://www.google.com/search?q=${encodeURIComponent(keyword + ' examples explanation')}`
            }));
            
            displayWebSearchResults(searchUrls, text);
        }

        function clearAnalysisInput() {
            document.getElementById('customAnalysisInput').value = '';
            showToast('Input cleared', 'info');
        }

        function generateExplanation(text) {
            const concepts = identifyConcepts(text);
            const examples = generateExamples(concepts);
            const breakdown = breakdownText(text);
            
            return {
                summary: `This text discusses ${concepts.join(', ')}. Here's a detailed breakdown:`,
                breakdown: breakdown,
                examples: examples,
                keyPoints: extractKeyPoints(text),
                difficulty: assessDifficulty(text)
            };
        }

        function identifyConcepts(text) {
            const words = text.toLowerCase().split(/\s+/);
            const concepts = [];
            const conceptWords = ['theory', 'principle', 'concept', 'method', 'process', 'system', 'model', 'framework'];
            words.forEach(word => {
                if (conceptWords.some(concept => word.includes(concept))) concepts.push(word);
            });
            return concepts.length > 0 ? concepts : ['general concepts'];
        }

        function generateExamples(concepts) {
            const examples = [];
            concepts.forEach(concept => {
                switch(concept.toLowerCase()) {
                    case 'theory':
                        examples.push('Like Einstein\'s Theory of Relativity explains space and time');
                        break;
                    case 'principle':
                        examples.push('Similar to the principle of supply and demand in economics');
                        break;
                    case 'process':
                        examples.push('Like the process of photosynthesis in plants');
                        break;
                    default:
                        examples.push(`Consider real-world applications of ${concept}`);
                }
            });
            return examples;
        }

        function breakdownText(text) {
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
            return sentences.map((sentence, index) => ({
                sentence: sentence.trim(),
                explanation: `Sentence ${index + 1}: This explains ${sentence.length > 50 ? 'a complex idea' : 'a key point'} about the topic.`
            }));
        }

        function extractKeyPoints(text) {
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 20);
            return sentences.slice(0, 3).map(s => s.trim());
        }

        function assessDifficulty(text) {
            const avgWordLength = text.split(/\s+/).reduce((sum, word) => sum + word.length, 0) / text.split(/\s+/).length;
            const avgSentenceLength = text.split(/[.!?]+/).reduce((sum, sentence) => sum + sentence.split(/\s+/).length, 0) / text.split(/[.!?]+/).length;
            if (avgWordLength > 6 && avgSentenceLength > 20) return 'Advanced';
            if (avgWordLength > 5 && avgSentenceLength > 15) return 'Intermediate';
            return 'Beginner';
        }

        function displayExplanation(explanation, originalText) {
            const resultsDiv = document.getElementById('analysisResults');
            resultsDiv.innerHTML = `
                <div class="card p-6">
                    <h3 class="text-xl font-semibold mb-4">
                        <i class="fas fa-brain mr-2" style="color: var(--accent-color);"></i>
                        AI Explanation & Examples
                    </h3>
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-2">Original Text:</h4>
                        <div class="p-4 bg-gray-100 rounded-lg italic">"${originalText}"</div>
                    </div>
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-3">Summary</h4>
                        <p class="text-gray-700">${explanation.summary}</p>
                        <div class="mt-2">
                            <span class="inline-block px-3 py-1 text-sm rounded-full" style="background-color: var(--hover-bg); color: var(--accent-color);">
                                Difficulty: ${explanation.difficulty}
                            </span>
                        </div>
                    </div>
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-3">Sentence Breakdown</h4>
                        <div class="space-y-3">
                            ${explanation.breakdown.map(item => `
                                <div class="summary-point">
                                    <p class="font-medium mb-1">"${item.sentence}"</p>
                                    <p class="text-sm text-gray-600">${item.explanation}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-3">Real-World Examples</h4>
                        <div class="space-y-2">
                            ${explanation.examples.map(example => `
                                <div class="summary-point">
                                    <i class="fas fa-lightbulb mr-2" style="color: var(--accent-color);"></i>
                                    ${example}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold mb-3">Key Takeaways</h4>
                        <div class="space-y-2">
                            ${explanation.keyPoints.map(point => `
                                <div class="summary-point">
                                    <i class="fas fa-check mr-2" style="color: var(--accent-color);"></i>
                                    ${point}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function displayWebSearchResults(searchUrls, originalText) {
            const resultsDiv = document.getElementById('analysisResults');
            resultsDiv.innerHTML = `
                <div class="card p-6">
                    <h3 class="text-xl font-semibold mb-4">
                        <i class="fas fa-search mr-2" style="color: var(--accent-color);"></i>
                        Web Search Results
                    </h3>
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-2">Searching for:</h4>
                        <div class="p-4 bg-gray-100 rounded-lg italic">"${originalText}"</div>
                    </div>
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-3">Recommended Searches</h4>
                        <p class="text-gray-600 mb-4">Click on these links to find more examples and explanations from the web:</p>
                        <div class="grid gap-4">
                            ${searchUrls.map(item => `
                                <a href="${item.url}" target="_blank" class="block p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-all">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h5 class="font-semibold">${item.keyword} Examples & Explanations</h5>
                                            <p class="text-sm text-gray-600">Search Google for detailed examples</p>
                                        </div>
                                        <i class="fas fa-external-link-alt text-blue-500"></i>
                                    </div>
                                </a>
                            `).join('')}
                            <a href="https://www.khanacademy.org/search?referer=%2F&page_search_query=${encodeURIComponent(originalText)}" target="_blank" class="block p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-all">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h5 class="font-semibold">Khan Academy Lessons</h5>
                                        <p class="text-sm text-gray-600">Find educational content and examples</p>
                                    </div>
                                    <i class="fas fa-external-link-alt text-blue-500"></i>
                                </div>
                            </a>
                            <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(originalText + ' explained with examples')}" target="_blank" class="block p-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-all">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h5 class="font-semibold">YouTube Video Explanations</h5>
                                        <p class="text-sm text-gray-600">Watch visual explanations and examples</p>
                                    </div>
                                    <i class="fas fa-external-link-alt text-blue-500"></i>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }

        function performAnalysis(content) {
            const words = content.split(/\s+/).filter(w => w.length > 0);
            const sentences = content.split(/[.!?]+/).filter(s => s.trim().length > 0);
            const paragraphs = content.split(/\n\s*\n/).filter(p => p.trim().length > 0);
            
            const keyPoints = sentences
                .filter(s => s.length > 50 && s.length < 200)
                .slice(0, 5)
                .map(s => s.trim());
            
            const lessons = [
                "Focus on understanding the main themes and concepts",
                "Take notes on important definitions and examples",
                "Review key points at the end of each section",
                "Connect new information to what you already know",
                "Use the voice recording feature to capture your thoughts"
            ];
            
            const searchSuggestions = extractKeywords(content).slice(0, 5);
            
            return {
                stats: {
                    words: words.length,
                    sentences: sentences.length,
                    paragraphs: paragraphs.length,
                    readingTime: Math.ceil(words.length / 200),
                    difficulty: assessDifficulty(content)
                },
                keyPoints,
                lessons,
                searchSuggestions
            };
        }

        function extractKeywords(content) {
            const words = content.toLowerCase().split(/\s+/);
            const stopWords = ['the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by', 'is', 'are', 'was', 'were', 'be', 'been', 'have', 'has', 'had', 'do', 'does', 'did', 'will', 'would', 'could', 'should', 'may', 'might', 'must', 'can', 'shall', 'this', 'that', 'these', 'those'];
            
            const wordFreq = {};
            words.forEach(word => {
                word = word.replace(/[^\w]/g, '');
                if (word.length > 3 && !stopWords.includes(word)) {
                    wordFreq[word] = (wordFreq[word] || 0) + 1;
                }
            });
            
            return Object.entries(wordFreq)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10)
                .map(([word]) => word);
        }

        function displayAnalysis(analysis, fileName) {
            const resultsDiv = document.getElementById('analysisResults');
            resultsDiv.innerHTML = `
                <div class="card p-6">
                    <h3 class="text-xl font-semibold mb-4">Analysis of: ${fileName}</h3>
                    <div class="grid md:grid-cols-5 gap-4 mb-6">
                        <div class="text-center">
                            <div class="text-2xl font-bold" style="color: var(--accent-color);">${analysis.stats.words}</div>
                            <div class="text-sm text-gray-600">Words</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold" style="color: var(--accent-color);">${analysis.stats.sentences}</div>
                            <div class="text-sm text-gray-600">Sentences</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold" style="color: var(--accent-color);">${analysis.stats.paragraphs}</div>
                            <div class="text-sm text-gray-600">Paragraphs</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold" style="color: var(--accent-color);">${analysis.stats.readingTime}</div>
                            <div class="text-sm text-gray-600">Min. Read</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg font-bold" style="color: var(--accent-color);">${analysis.stats.difficulty}</div>
                            <div class="text-sm text-gray-600">Level</div>
                        </div>
                    </div>
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-3">Key Points</h4>
                        <div class="space-y-2">
                            ${analysis.keyPoints.map(point => `
                                <div class="summary-point">
                                    <i class="fas fa-chevron-right mr-2" style="color: var(--accent-color);"></i>
                                    ${point}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-3">Learning Tips</h4>
                        <div class="space-y-2">
                            ${analysis.lessons.map(lesson => `
                                <div class="summary-point">
                                    <i class="fas fa-lightbulb mr-2" style="color: var(--accent-color);"></i>
                                    ${lesson}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold mb-3">Suggested Web Searches</h4>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                            ${analysis.searchSuggestions.map(keyword => `
                                <a href="https://www.google.com/search?q=${encodeURIComponent(keyword)}" 
                                   target="_blank" 
                                   class="btn-secondary text-sm text-center">
                                    ${keyword} <i class="fas fa-external-link-alt ml-1"></i>
                                </a>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // Language update function
        function updateLanguage() {
            const selectedLang = document.getElementById('languageSelector').value;
            showToast(`Language changed to ${selectedLang.toUpperCase()}`, 'info');
        }

        // Utility functions
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            toast.className = `fixed bottom-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all transform translate-y-0`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : type === 'warning' ? 'exclamation' : 'info'} mr-2"></i>
                    ${message}
                </div>
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.style.transform = 'translateY(-10px)', 100);
            setTimeout(() => {
                toast.style.transform = 'translateY(100px)';
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Event listeners
        document.getElementById('languageSelector').addEventListener('change', updateLanguage);
        document.getElementById('dictionaryInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') searchDictionary();
        });
        document.getElementById('quickNoteInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) saveQuickNote();
        });
        document.getElementById('customAnalysisInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) explainText();
        });

        // Mobile responsiveness
        function toggleMobileMenu() {
            const sidebar = document.getElementById('navSidebar');
            const rightPanel = document.getElementById('rightPanel');
            sidebar.classList.toggle('open');
            rightPanel.classList.toggle('open');
        }

        if (window.innerWidth <= 1024) {
            const mobileToggle = document.createElement('button');
            mobileToggle.innerHTML = '<i class="fas fa-bars"></i>';
            mobileToggle.className = 'fixed top-4 left-4 z-50 bg-blue-500 text-white p-2 rounded-lg';
            mobileToggle.onclick = toggleMobileMenu;
            document.body.appendChild(mobileToggle);
        }
    </script>
</body>
</html>
